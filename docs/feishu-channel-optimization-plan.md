# Feishu é€šé“ä¼˜åŒ–æ–¹æ¡ˆï¼šåˆ©ç”¨ OpenClaw åŸç”Ÿæ‰©å±•

## èƒŒæ™¯

### å½“å‰æ¶æ„

Clawbot-manager ç›®å‰å®ç°äº†è‡ªå®šä¹‰çš„é£ä¹¦æ¶ˆæ¯å¤„ç†é€»è¾‘ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Clawbot-manager (å½“å‰å®ç°)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  é£ä¹¦æœåŠ¡å™¨ â”€â”€WSâ”€â”€â–¶ FeishuClientService                              â”‚
â”‚                           â”‚                                          â”‚
â”‚                           â–¼                                          â”‚
â”‚                  FeishuMessageHandlerService                         â”‚
â”‚                           â”‚                                          â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚              â–¼            â–¼            â–¼                             â”‚
â”‚         æ¶ˆæ¯è§£æ     æ¶ˆæ¯å»é‡      å¤šæ¨¡æ€å¤„ç†                           â”‚
â”‚              â”‚            â”‚            â”‚                             â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                           â–¼                                          â”‚
â”‚                   OpenClaw Gateway                                   â”‚
â”‚                           â”‚                                          â”‚
â”‚                           â–¼                                          â”‚
â”‚                    AI å“åº”å›å¤é£ä¹¦                                    â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç›¸å…³æ–‡ä»¶**:

- `apps/api/src/modules/bot-channel-api/feishu-message-handler.service.ts` (740 è¡Œ)
- `apps/api/libs/infra/clients/internal/feishu/` (å¤šä¸ªæ–‡ä»¶)
- `apps/api/src/modules/bot-channel-api/bot-channel-startup.service.ts`

### OpenClaw åŸç”Ÿå®ç°

OpenClaw ä»æ–°ç‰ˆæœ¬å¼€å§‹å†…ç½®äº† feishu æ‰©å±• (`extensions/feishu/`)ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OpenClaw Gateway (åŸç”Ÿæ‰©å±•)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  extensions/feishu/                                                 â”‚
â”‚  â”œâ”€â”€ openclaw.plugin.json    # æ’ä»¶é…ç½®                              â”‚
â”‚  â”œâ”€â”€ src/                                                             â”‚
â”‚  â”‚   â”œâ”€â”€ channel.ts          # é€šé“å®ç° (277 è¡Œ)                      â”‚
â”‚  â”‚   â”œâ”€â”€ config-schema.ts    # é…ç½® Schema                           â”‚
â”‚  â”‚   â””â”€â”€ onboarding.ts       # å¼•å¯¼é…ç½®                              â”‚
â”‚  â”‚                                                                   â”‚
â”‚  src/feishu/                                                         â”‚
â”‚  â”œâ”€â”€ index.ts                # å¯¼å‡º                                  â”‚
â”‚  â”œâ”€â”€ client.ts               # API å®¢æˆ·ç«¯                            â”‚
â”‚  â”œâ”€â”€ bot.ts                  # æœºå™¨äººé€»è¾‘                            â”‚
â”‚  â”œâ”€â”€ message.ts              # æ¶ˆæ¯å¤„ç†                              â”‚
â”‚  â”œâ”€â”€ monitor.ts              # è¿æ¥ç›‘æ§                              â”‚
â”‚  â”œâ”€â”€ send.ts                 # æ¶ˆæ¯å‘é€                              â”‚
â”‚  â””â”€â”€ ...                                                             â”‚
â”‚                                                                      â”‚
â”‚  åŠŸèƒ½ç‰¹æ€§:                                                           â”‚
â”‚  âœ… DM é…å¯¹ (pairing)                                                â”‚
â”‚  âœ… æ¶ˆæ¯æ”¶å‘ (direct + group)                                        â”‚
â”‚  âœ… å¤šåª’ä½“æ”¯æŒ (media)                                               â”‚
â”‚  âœ… Block æµå¼è¾“å‡º                                                   â”‚
â”‚  âœ… å®‰å…¨ç­–ç•¥ (dmPolicy)                                              â”‚
â”‚  âœ… è´¦æˆ·ç®¡ç† (å¤šè´¦æˆ·)                                                 â”‚
â”‚  âœ… çŠ¶æ€ç›‘æ§ (probe)                                                 â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¼˜åŒ–ç›®æ ‡

| ç›®æ ‡         | è¯´æ˜                                        |
| ------------ | ------------------------------------------- |
| **ç®€åŒ–æ¶æ„** | ç§»é™¤ clawbot-manager ä¸­çš„é£ä¹¦è¿æ¥ç®¡ç†ä»£ç    |
| **å‡å°‘ç»´æŠ¤** | åˆ©ç”¨ OpenClaw ç¤¾åŒºç»´æŠ¤çš„ feishu æ‰©å±•        |
| **åŠŸèƒ½å¯¹é½** | OpenClaw åŸç”Ÿæ”¯æŒå¤šæ¨¡æ€ã€é…å¯¹ã€ç¾¤ç»„ç­‰åŠŸèƒ½   |
| **é…ç½®é©±åŠ¨** | é€šè¿‡ Bot é…ç½®æ–‡ä»¶å¯ç”¨é£ä¹¦é€šé“ï¼Œæ— éœ€é¢å¤–ä»£ç  |

---

## ä¼˜åŒ–åæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¼˜åŒ–åæ¶æ„                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  é£ä¹¦æœåŠ¡å™¨ â”€â”€WSâ”€â”€â–¶ OpenClaw Gateway (å†…ç½® feishu æ‰©å±•)              â”‚
â”‚                           â”‚                                          â”‚
â”‚                           â–¼                                          â”‚
â”‚                  OpenClaw feishu channel                             â”‚
â”‚                           â”‚                                          â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚              â–¼            â–¼            â–¼                             â”‚
â”‚         æ¶ˆæ¯è·¯ç”±      DM é…å¯¹       å¤šæ¨¡æ€å¤„ç†                         â”‚
â”‚              â”‚            â”‚            â”‚                             â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                           â–¼                                          â”‚
â”‚                    AI Agent å“åº”                                     â”‚
â”‚                           â”‚                                          â”‚
â”‚                           â–¼                                          â”‚
â”‚                    ç›´æ¥å›å¤é£ä¹¦                                       â”‚
â”‚                                                                      â”‚
â”‚  Clawbot-manager (ç®€åŒ–å):                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  - Bot ç”Ÿå‘½å‘¨æœŸç®¡ç† (åˆ›å»º/å¯åŠ¨/åœæ­¢/åˆ é™¤)                      â”‚    â”‚
â”‚  â”‚  - é…ç½®ç®¡ç† (å†™å…¥ openclaw.json)                              â”‚    â”‚
â”‚  â”‚  - é£ä¹¦å‡­è¯å­˜å‚¨ (appId, appSecret)                            â”‚    â”‚
â”‚  â”‚  - Bot çŠ¶æ€ç›‘æ§                                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å®æ–½æ­¥éª¤

### Phase 1: åˆ†æä¸å‡†å¤‡ âœ… å·²å®Œæˆ

**ä»»åŠ¡**:

- [x] åˆ†æ OpenClaw feishu æ‰©å±•å®ç°
- [x] å¯¹æ¯”å½“å‰ clawbot-manager é£ä¹¦å¤„ç†é€»è¾‘
- [x] ç¡®è®¤åŠŸèƒ½å¯¹é½æƒ…å†µ
- [x] å¼€å§‹å®æ–½è¿ç§»

**è¿ç§»å®æ–½çŠ¶æ€**: è¯¦è§ [feishu-channel-migration-implementation.md](./feishu-channel-migration-implementation.md)

**OpenClaw feishu æ‰©å±•èƒ½åŠ›**:

```typescript
// extensions/feishu/src/channel.ts
capabilities: {
  chatTypes: ['direct', 'group'],  // âœ… æ”¯æŒç§èŠå’Œç¾¤èŠ
  media: true,                      // âœ… æ”¯æŒå¤šåª’ä½“
  reactions: false,                 // âŒ ä¸æ”¯æŒè¡¨æƒ…å›åº”
  threads: false,                   // âŒ ä¸æ”¯æŒçº¿ç¨‹
  polls: false,                     // âŒ ä¸æ”¯æŒæŠ•ç¥¨
  nativeCommands: false,            // âŒ ä¸æ”¯æŒåŸç”Ÿå‘½ä»¤
  blockStreaming: true,             // âœ… æ”¯æŒæµå¼è¾“å‡º
}
```

### Phase 2: é…ç½®è¿ç§» âœ… å·²å®Œæˆ

**å½“å‰é…ç½®æ–¹å¼** (clawbot-manager):

```typescript
// BotChannel è¡¨å­˜å‚¨é£ä¹¦é…ç½®
{
  channelType: 'feishu',
  credentials: {
    appId: 'cli_xxx',
    appSecret: 'xxx'
  }
}
```

**ç›®æ ‡é…ç½®æ–¹å¼** (OpenClaw):

```json
// openclaw.json
{
  "channels": {
    "feishu": {
      "appId": "cli_xxx",
      "appSecret": "xxx",
      "dmPolicy": "pairing",
      "allowFrom": ["ou_xxx"]
    }
  }
}
```

**å®ç°çŠ¶æ€**:

| åŠŸèƒ½ | çŠ¶æ€ | å®ç°ä½ç½® |
|------|------|----------|
| `buildFeishuChannelConfig()` | âœ… å·²å®ç° | [workspace.service.ts:94-125](apps/api/src/modules/bot-api/services/workspace.service.ts#L94-L125) |
| `updateFeishuChannelConfig()` | âœ… å·²å®ç° | [workspace.service.ts:336-388](apps/api/src/modules/bot-api/services/workspace.service.ts#L336-L388) |
| `removeFeishuChannelConfig()` | âœ… å·²å®ç° | [workspace.service.ts:394-438](apps/api/src/modules/bot-api/services/workspace.service.ts#L394-L438) |
| `syncFeishuChannelsConfig()` | âœ… å·²å®ç° | [workspace.service.ts:445-490](apps/api/src/modules/bot-api/services/workspace.service.ts#L445-L490) |
| åˆ›å»ºæ¸ é“æ—¶åŒæ­¥é…ç½® | âœ… å·²å®ç° | [bot-channel-api.service.ts:167-189](apps/api/src/modules/bot-channel-api/bot-channel-api.service.ts#L167-L189) |
| æ›´æ–°æ¸ é“æ—¶åŒæ­¥é…ç½® | âœ… å·²å®ç° | [bot-channel-api.service.ts:302-336](apps/api/src/modules/bot-channel-api/bot-channel-api.service.ts#L302-L336) |
| åˆ é™¤æ¸ é“æ—¶åŒæ­¥é…ç½® | âœ… å·²å®ç° | [bot-channel-api.service.ts:398-418](apps/api/src/modules/bot-channel-api/bot-channel-api.service.ts#L398-L418) |

### Phase 3: ä»£ç æ¸…ç† âœ… å·²å®Œæˆ

**å½“å‰çŠ¶æ€**ï¼šä»£ç æ¸…ç†å·²å®Œæˆï¼ŒWebSocket è¿æ¥é€»è¾‘å·²å®Œå…¨è¿ç§»åˆ° OpenClaw åŸç”Ÿ feishu æ‰©å±•ã€‚

**å·²åˆ é™¤çš„æ–‡ä»¶**:

| æ–‡ä»¶ | å¤„ç†æ–¹å¼ | åˆ é™¤å†…å®¹ | å¤‡æ³¨ |
|------|----------|----------|------|
| `feishu-message-handler.service.ts` | âœ… å·²åˆ é™¤ | 740 è¡Œ | æ¶ˆæ¯å¤„ç†ã€å»é‡ã€å¤šæ¨¡æ€å¤„ç† |
| `feishu-sdk.client.ts` | âœ… å·²åˆ é™¤ | ~200 è¡Œ | é£ä¹¦å®˜æ–¹ SDK å°è£… |
| `feishu-message-parser.ts` | âœ… å·²åˆ é™¤ | ~100 è¡Œ | æ¶ˆæ¯è§£æé€»è¾‘ |

**å·²ç®€åŒ–çš„æ–‡ä»¶**:

| æ–‡ä»¶ | å¤„ç†æ–¹å¼ | ç®€åŒ–å†…å®¹ | å¤‡æ³¨ |
|------|----------|----------|------|
| `feishu-client.service.ts` | âœ… å·²ç®€åŒ– | 167 â†’ 71 è¡Œ | ä»…ä¿ç•™ API å®¢æˆ·ç«¯åˆ›å»ºå’Œå‡­è¯éªŒè¯ |
| `bot-channel-api.service.ts` | âœ… å·²ç®€åŒ– | 1070 â†’ 852 è¡Œ | ç§»é™¤ WebSocket è¿æ¥ç®¡ç† |
| `bot-channel-api.module.ts` | âœ… å·²ç®€åŒ– | - | ç§»é™¤ FeishuClientModuleã€OpenClawModule ç­‰ä¾èµ– |
| `bot-channel-api.controller.ts` | âœ… å·²æ›´æ–° | - | connection ç«¯ç‚¹æ ‡è®°ä¸º @deprecated |

**ä¿ç•™çš„åŠŸèƒ½**:

- âœ… é£ä¹¦å‡­è¯çš„åŠ å¯†å­˜å‚¨ï¼ˆå·²å®ç°ï¼‰
- âœ… Bot é…ç½® UI ä¸­çš„é£ä¹¦é€šé“è®¾ç½®ï¼ˆå·²å®ç°ï¼‰
- âœ… é£ä¹¦è¿æ¥çŠ¶æ€çš„æ˜¾ç¤ºï¼ˆå·²å®ç°ï¼‰
- âœ… å‡­è¯éªŒè¯æµ‹è¯•ï¼ˆå·²å®ç°ï¼‰
- âœ… FeishuApiClientï¼ˆç”¨äºå‡­è¯éªŒè¯å’Œç®¡ç†æ“ä½œï¼‰

**æ¶æ„å˜åŒ–**:

```
ä¼˜åŒ–å‰:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é£ä¹¦æœåŠ¡å™¨ â”€â”€WSâ”€â”€â–¶ FeishuClientService â”€â”€â–¶ FeishuMessageHandler    â”‚
â”‚                           â”‚                                          â”‚
â”‚                           â–¼                                          â”‚
â”‚                   OpenClaw Gateway                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¼˜åŒ–å:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é£ä¹¦æœåŠ¡å™¨ â”€â”€WSâ”€â”€â–¶ OpenClaw Gateway (å†…ç½® feishu æ‰©å±•)              â”‚
â”‚                           â”‚                                          â”‚
â”‚                           â–¼                                          â”‚
â”‚                    AI Agent å“åº”                                     â”‚
â”‚                                                                      â”‚
â”‚  Clawbot-manager:                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  - BotChannelApiService (é…ç½® CRUD)                         â”‚    â”‚
â”‚  â”‚  - WorkspaceService (openclaw.json æ›´æ–°)                    â”‚    â”‚
â”‚  â”‚  - FeishuApiClient (å‡­è¯éªŒè¯ï¼Œå¯é€‰)                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Phase 4: é…ç½®ç”Ÿæˆæ›´æ–° âœ… å·²å®Œæˆ

**WorkspaceService å®ç°çŠ¶æ€**:

```typescript
// apps/api/src/modules/bot-api/services/workspace.service.ts

// âœ… å·²å®ç°ï¼šFeishuChannelConfig ç±»å‹å®šä¹‰ (9-19 è¡Œ)
export interface FeishuChannelConfig {
  appId: string;
  appSecret: string;
  domain?: 'feishu' | 'lark';
  dmPolicy?: 'pairing' | 'allowlist' | 'open' | 'disabled';
  allowFrom?: string[];
  requireMention?: boolean;
  replyInThread?: boolean;
  showTyping?: boolean;
  enabled?: boolean;
}

// âœ… å·²å®ç°ï¼šbuildOpenclawConfig æ–¹æ³• (131-167 è¡Œ)
private buildOpenclawConfig(config: BotWorkspaceConfig): Record<string, unknown> {
  // åŒ…å« AI æ¨¡å‹é…ç½®ã€ç½‘å…³é…ç½®ã€é€šé“é…ç½®
}

// âœ… å·²å®ç°ï¼šcreateWorkspace æ—¶è‡ªåŠ¨ç”Ÿæˆ openclaw.json (173-238 è¡Œ)
async createWorkspace(config: BotWorkspaceConfig): Promise<string> {
  // å¦‚æœæœ‰ channels æˆ– gatewayTokenï¼Œè‡ªåŠ¨åˆ›å»º openclaw.json
}
```

### Phase 5: æµ‹è¯•ä¸éªŒè¯ ğŸ“‹ å¾…å¼€å§‹

**æµ‹è¯•æ¸…å•**:

- [ ] é£ä¹¦ Bot åˆ›å»ºæµç¨‹
- [ ] é£ä¹¦é€šé“é…ç½®å†™å…¥ openclaw.json
- [ ] OpenClaw å¯åŠ¨åè‡ªåŠ¨è¿æ¥é£ä¹¦
- [ ] æ¶ˆæ¯æ”¶å‘æ­£å¸¸
- [ ] å¤šæ¨¡æ€æ¶ˆæ¯ï¼ˆå›¾ç‰‡ã€æ–‡ä»¶ï¼‰å¤„ç†
- [ ] ç¾¤èŠæ¶ˆæ¯å¤„ç†
- [ ] DM é…å¯¹æµç¨‹

---

## è¿ç§»é£é™©ä¸ç¼“è§£

| é£é™©          | å½±å“         | ç¼“è§£æªæ–½                                      | çŠ¶æ€ |
| ------------- | ------------ | --------------------------------------------- | ---- |
| åŠŸèƒ½ä¸å¯¹é½    | éƒ¨åˆ†åŠŸèƒ½ç¼ºå¤± | è¯„ä¼° OpenClaw feishu æ‰©å±•èƒ½åŠ›ï¼Œå¿…è¦æ—¶è´¡çŒ®ä»£ç  | ğŸ”„ è¯„ä¼°ä¸­ |
| ç°æœ‰ Bot å…¼å®¹ | éœ€è¦é‡æ–°é…ç½® | æä¾›è¿ç§»è„šæœ¬ï¼Œè‡ªåŠ¨è½¬æ¢ç°æœ‰é…ç½® | âœ… é…ç½®åŒæ­¥å·²å®ç° |
| è°ƒè¯•å›°éš¾      | é—®é¢˜å®šä½å¤æ‚ | ä¿ç•™è¯¦ç»†æ—¥å¿—ï¼Œå»ºç«‹ç›‘æ§æœºåˆ¶ | ğŸ“‹ å¾…å®æ–½ |

---

## é¢„æœŸæ”¶ç›Š

| æŒ‡æ ‡         | å½“å‰            | ä¼˜åŒ–å           | å®é™…çŠ¶æ€ |
| ------------ | --------------- | ---------------- | -------- |
| é£ä¹¦ç›¸å…³ä»£ç  | ~1000+ è¡Œ       | ~200 è¡Œ (ä»…é…ç½®) | âœ… ~200 è¡Œ (å·²æ¸…ç†) |
| ç»´æŠ¤è´Ÿæ‹…     | é«˜ (è‡ªå®šä¹‰å®ç°) | ä½ (ç¤¾åŒºç»´æŠ¤)    | âœ… ä½ (ä»…é…ç½®ç®¡ç†) |
| åŠŸèƒ½æ›´æ–°     | éœ€è‡ªè¡Œå¼€å‘      | è‡ªåŠ¨è·å¾—ç¤¾åŒºæ›´æ–° | âœ… è‡ªåŠ¨è·å¾— |
| æ¶æ„å¤æ‚åº¦   | å¤šå±‚è½¬å‘        | ç›´æ¥å¤„ç†         | âœ… ç›´æ¥å¤„ç† |

---

## å®æ–½æ—¶é—´çº¿

| Phase                 | é¢„è®¡æ—¶é—´ | çŠ¶æ€      | å®Œæˆåº¦ |
| --------------------- | -------- | --------- | ------ |
| Phase 1: åˆ†æä¸å‡†å¤‡   | 1 å¤©     | âœ… å®Œæˆ   | 100% |
| Phase 2: é…ç½®è¿ç§»     | 2 å¤©     | âœ… å®Œæˆ   | 100% |
| Phase 3: ä»£ç æ¸…ç†     | 1 å¤©     | âœ… å®Œæˆ   | 100% |
| Phase 4: é…ç½®ç”Ÿæˆæ›´æ–° | 1 å¤©     | âœ… å®Œæˆ   | 100% |
| Phase 5: æµ‹è¯•ä¸éªŒè¯   | 1 å¤©     | ğŸ“‹ å¾…å¼€å§‹ | 0% |

**æ€»ä½“è¿›åº¦**: çº¦ 80% å®Œæˆï¼ˆä»£ç æ¸…ç†å·²å®Œæˆï¼Œå¾…æµ‹è¯•éªŒè¯ï¼‰

---

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³è¡ŒåŠ¨

1. ~~**ç¡®è®¤ OpenClaw ç‰ˆæœ¬**: ç¡®ä¿ä½¿ç”¨çš„ openclaw é•œåƒåŒ…å« feishu æ‰©å±•~~ âœ… å·²ç¡®è®¤
2. ~~**é…ç½®åŒæ­¥**: å®ç° openclaw.json è‡ªåŠ¨æ›´æ–°~~ âœ… å·²å®ç°
3. ~~**ä»£ç æ¸…ç†**: ç§»é™¤æ—§ç‰ˆé£ä¹¦å¤„ç†ä»£ç ~~ âœ… å·²å®Œæˆ
4. **åŠŸèƒ½éªŒè¯**: åˆ›å»ºä¸€ä¸ªä½¿ç”¨ OpenClaw åŸç”Ÿ feishu çš„ Bot éªŒè¯æµç¨‹ ğŸ“‹ å¾…å¼€å§‹

### Phase 5: æµ‹è¯•éªŒè¯æ¸…å•

- [ ] é£ä¹¦ Bot åˆ›å»ºæµç¨‹
- [ ] é£ä¹¦é€šé“é…ç½®å†™å…¥ openclaw.json
- [ ] OpenClaw å¯åŠ¨åè‡ªåŠ¨è¿æ¥é£ä¹¦
- [ ] æ¶ˆæ¯æ”¶å‘æ­£å¸¸
- [ ] å¤šæ¨¡æ€æ¶ˆæ¯ï¼ˆå›¾ç‰‡ã€æ–‡ä»¶ï¼‰å¤„ç†
- [ ] ç¾¤èŠæ¶ˆæ¯å¤„ç†
- [ ] DM é…å¯¹æµç¨‹

---

## é™„å½•ï¼šOpenClaw Feishu æ‰©å±•æ–‡ä»¶ç»“æ„

```
openclaw/
â”œâ”€â”€ extensions/
â”‚   â””â”€â”€ feishu/
â”‚       â”œâ”€â”€ index.ts              # æ‰©å±•å…¥å£
â”‚       â”œâ”€â”€ openclaw.plugin.json  # æ’ä»¶å…ƒæ•°æ®
â”‚       â”œâ”€â”€ package.json          # ä¾èµ–é…ç½®
â”‚       â””â”€â”€ src/
â”‚           â”œâ”€â”€ channel.ts        # é€šé“æ’ä»¶å®ç°
â”‚           â”œâ”€â”€ config-schema.ts  # é…ç½® Schema
â”‚           â””â”€â”€ onboarding.ts     # å¼•å¯¼é€‚é…å™¨
â”‚
â””â”€â”€ src/
    â””â”€â”€ feishu/
        â”œâ”€â”€ index.ts              # å¯¼å‡º
        â”œâ”€â”€ access.ts             # è®¿é—®æ§åˆ¶
        â”œâ”€â”€ accounts.ts           # è´¦æˆ·ç®¡ç†
        â”œâ”€â”€ bot.ts                # Bot é€»è¾‘
        â”œâ”€â”€ client.ts             # API å®¢æˆ·ç«¯
        â”œâ”€â”€ config.ts             # é…ç½®å¤„ç†
        â”œâ”€â”€ domain.ts             # åŸŸåå¤„ç†
        â”œâ”€â”€ download.ts           # æ–‡ä»¶ä¸‹è½½
        â”œâ”€â”€ format.ts             # æ¶ˆæ¯æ ¼å¼åŒ–
        â”œâ”€â”€ message.ts            # æ¶ˆæ¯å¤„ç†
        â”œâ”€â”€ monitor.ts            # è¿æ¥ç›‘æ§
        â”œâ”€â”€ pairing-store.ts      # é…å¯¹å­˜å‚¨
        â”œâ”€â”€ probe.ts              # æ¢æµ‹
        â”œâ”€â”€ send.ts               # å‘é€
        â”œâ”€â”€ streaming-card.ts     # æµå¼å¡ç‰‡
        â””â”€â”€ types.ts              # ç±»å‹å®šä¹‰
```

---

## é™„å½•ï¼šå½“å‰ä»£ç ä¾èµ–å…³ç³»

```
ä¼˜åŒ–å‰:
BotChannelApiModule
â”œâ”€â”€ BotChannelApiService
â”‚   â”œâ”€â”€ FeishuClientService â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   â”‚   â”œâ”€â”€ FeishuApiClient (REST API)       â”‚ ä¿ç•™
â”‚   â”‚   â””â”€â”€ FeishuSdkClient (WebSocket) â”€â”€â”€â”€â”€â”¤ åˆ é™¤
â”‚   â””â”€â”€ FeishuMessageHandlerService â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ åˆ é™¤
â”‚       â”œâ”€â”€ parseFeishuMessage() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ åˆ é™¤
â”‚       â””â”€â”€ OpenClawClient.chat() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ä¿ç•™
â”‚
â””â”€â”€ BotChannelStartupService
    â””â”€â”€ validateAllFeishuChannels() â”€â”€â”€â”€â”€â”€â”€â”€â”€ ä¿ç•™ï¼ˆä»…éªŒè¯é…ç½®ï¼‰

ä¼˜åŒ–å:
BotChannelApiModule
â”œâ”€â”€ BotChannelApiService
â”‚   â””â”€â”€ WorkspaceService â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ é…ç½®åŒæ­¥åˆ° openclaw.json
â”‚
â””â”€â”€ BotChannelStartupService
    â””â”€â”€ validateAllFeishuChannels() â”€â”€â”€â”€â”€â”€â”€â”€â”€ ä»…éªŒè¯é…ç½®

FeishuClientModule (å¯é€‰ï¼Œä»…ç”¨äºå‡­è¯éªŒè¯)
â””â”€â”€ FeishuClientService
    â””â”€â”€ createApiClient() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ åˆ›å»º API å®¢æˆ·ç«¯ç”¨äºæµ‹è¯•
```

---

_æ–‡æ¡£åˆ›å»ºæ—¶é—´: 2026-02-21_
_æœ€åæ›´æ–°: 2026-02-21_
_æ£€æŸ¥çŠ¶æ€: å·²å®Œæˆä»£ç æ·±åº¦æ£€æŸ¥_
_ä»£ç æ¸…ç†: å·²å®Œæˆï¼ˆåˆ é™¤ ~1000+ è¡Œæ—§ç‰ˆä»£ç ï¼‰_
